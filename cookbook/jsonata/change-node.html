<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><title>Change node | node-red-contrib-home-assistant-websocket</title><meta name="description" content="Node-RED integration with Home Assistant through the WebSocket and HTTP API">
    <link rel="preload" href="/node-red-contrib-home-assistant-websocket/assets/style-B3iS_lJd.css" as="style"><link rel="stylesheet" href="/node-red-contrib-home-assistant-websocket/assets/style-B3iS_lJd.css">
    <link rel="modulepreload" href="/node-red-contrib-home-assistant-websocket/assets/app-sKDtX2xl.js"><link rel="modulepreload" href="/node-red-contrib-home-assistant-websocket/assets/change-node.html-DUourPF5.js"><link rel="modulepreload" href="/node-red-contrib-home-assistant-websocket/assets/change-node.html-6Ug8hWEh.js">
    <link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/FAQ.html-DJ7cnGer.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-DTszCqDu.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-WMUoZnqy.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/actionable-notifications-subflow-for-android.html-BoPaXVyh.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/check-if-an-entity-was-turned-on-in-the-last-24-hours.html-Bb7POubS.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/expiration-date-monitor.html-4_kB1H6C.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-state_changed-events-based-on-area.html-CwF3ERMA.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/holiday-lights-scheduler-and-demo-mode-for-wled.html-BuFgBLlB.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/motion-triggered-light.html-BsdTkCoX.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/saving-and-restoring-states.html-Bn4K2Zdu.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/starting-flow-after-home-assistant-restart.html-DKAjP2bd.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sun-events.html-DbAS3TBD.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/using-date-and-time-entities-to-trigger-flows.html-D1R0f_8A.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/vacation-mode.html-B2l6IzlV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-uF_24AQ3.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/call-service.html-BQe5s5MR.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/conditionals.html-wYgbDmQg.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/development.html-kF-1ViGv.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/diagnostics.html-d7C2KoqA.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/documentation.html-gj5aEpbG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/first-automation.html-RzwC4Kux.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/jsonata-primer.html-DMLSrKUK.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/jsonata.html-RP9mWEVP.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/migration.html-BjOR_TVH.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/mustache-templates.html-BLOVAawv.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/API.html-DH3PYQg3.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-Dwk15XlR.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/binary-sensor.html-rtDojaoD.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/button.html-D9AM0-MO.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/call-service.html-y7bOKfAk.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/config-server.html-B9BPPMNa.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/current-state.html-CZ78JpiO.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/device-config.html-DBtsAxx_.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/device.html-E7Z05I5q.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/entity-config.html-C3xR_Dqh.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/entity.html-jUBk_EPe.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-all.html-DbDqpqdo.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-calendar.html-J-EltcIZ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-state.html-zatVZ_MO.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/fire-event.html-C7OeQhev.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-entities.html-D6RrCGBK.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-history.html-TruWrGGx.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/number.html-CZ8kRhZm.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/poll-state.html-UM4aczzK.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/render-template.html-KPEunZUG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/select.html-Ca9oVm0u.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sensor.html-DxUHHwO-.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sentence.html-spCQS_3K.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/switch.html-BDSO4KRT.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/tag.html-CUfdOsmM.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/text.html-DGk7Mgec.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/time-entity.html-D25rrN03.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/time.html-B0UXqkE9.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/trigger-state.html-Riz8HFc4.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/update-config.html-BbAjktc_.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/wait-until.html-CkLobiu6.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/webhook.html-FcIF4iwS.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/zone.html-B_JK36d1.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-DwBRaoZp.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/call-service.html-DJYwjEQh.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/current-state.html-GzI9UrvW.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-state.html-C4N0Wz8l.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/functions.html-D0wgvPkI.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sensor.html-D_exYr14.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/switch-node.html-JuB0uyLv.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/trigger-state.html-BAz_Vz5r.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-CqxUbxbp.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/exposed-nodes.html-ILHhxMf-.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/404.html-5sy5zeZP.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/FAQ.html-cQz2F9Po.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-C6ll2vrV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-rp4hCxWc.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/actionable-notifications-subflow-for-android.html-D5FeEFaD.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/check-if-an-entity-was-turned-on-in-the-last-24-hours.html-BPA2fTru.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/expiration-date-monitor.html-BHzYLtia.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-state_changed-events-based-on-area.html-B6VMb2WL.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/holiday-lights-scheduler-and-demo-mode-for-wled.html-3oWHJPIg.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/motion-triggered-light.html-hhHjKKMR.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/saving-and-restoring-states.html-CA1P5ScQ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/starting-flow-after-home-assistant-restart.html-BKFNU2UW.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sun-events.html-D9HDaymq.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/using-date-and-time-entities-to-trigger-flows.html-B76hoW4r.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/vacation-mode.html-vUTUkI1T.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-Bwy99xQT.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/call-service.html-f9IsU-8t.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/conditionals.html-CX3dNgxJ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/development.html-D0Zm9iXV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/diagnostics.html-DEgJPWxr.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/documentation.html-CXjca37m.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/first-automation.html-DmUqRcOn.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/jsonata-primer.html-B0qjipOa.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/jsonata.html-Bulhfg0I.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/migration.html-CqrI5-vh.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/mustache-templates.html-BdZIZOrZ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/API.html-CtUZBey5.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-BC-dTdp4.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/binary-sensor.html-BVQga1Xh.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/button.html-BSb0L6xS.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/call-service.html-Bfuksm96.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/config-server.html-DVk0EUK_.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/current-state.html-micS0Bh7.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/device-config.html-NuQHyMLG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/device.html-9OGjPNJq.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/entity-config.html-BT7e6lln.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/entity.html-AzoGYgfK.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-all.html-qVbN6l6r.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-calendar.html-C3fzDuCC.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-state.html-D1iW7J7F.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/fire-event.html-CYzocUvR.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-entities.html-CCZk61gD.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-history.html-BY8p57M8.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/number.html-Cdp2-gCK.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/poll-state.html-B62ZSVyt.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/render-template.html-DW6jfrM0.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/select.html-A6vNej-l.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sensor.html-C8D8oX4P.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sentence.html-BvnRznGW.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/switch.html-C4AgRnd8.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/tag.html-MXcwc7CC.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/text.html-CIAwtxbE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/time-entity.html-BsgEVb9U.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/time.html-B-G_l_2C.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/trigger-state.html-C51WYUoc.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/update-config.html-21p62_ZL.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/wait-until.html-u9GYWN_t.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/webhook.html-DjAJRtwV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/zone.html-JRs3jqy0.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-a_PSE7kw.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/call-service.html-1ZxaEQIa.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/current-state.html-CidsTQC3.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-state.html-DXtRe63u.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/functions.html-_TUjr2mE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sensor.html-CSef6iTE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/switch-node.html-v8-_aMWE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/trigger-state.html-DhLsiV9Y.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-Co5qo3c_.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/exposed-nodes.html-De4kL78p.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/404.html-yJmcT4Ko.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/DocsOnly-BzDFjUoY.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/InfoPanelOnly-B6n4X4h2.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/Scrubber-D0q4hF5P.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/node-red-contrib-home-assistant-websocket/" class=""><!----><span class="site-name">node-red-contrib-home-assistant-websocket</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/guide/" class="" aria-label="Guides"><!--[--><!--]--> Guides <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/node/" class="" aria-label="Nodes"><!--[--><!--]--> Nodes <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/FAQ.md" class="" aria-label="FAQ"><!--[--><!--]--> FAQ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/cookbook/" class="router-link-active" aria-label="Cookbook"><!--[--><!--]--> Cookbook <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/scrubber/" class="" aria-label="Scrubber"><!--[--><!--]--> Scrubber <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions" rel="noopener noreferrer" target="_blank" aria-label="Forums"><!--[--><!--]--> Forums <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/guide/" class="" aria-label="Guides"><!--[--><!--]--> Guides <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/node/" class="" aria-label="Nodes"><!--[--><!--]--> Nodes <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/FAQ.md" class="" aria-label="FAQ"><!--[--><!--]--> FAQ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/cookbook/" class="router-link-active" aria-label="Cookbook"><!--[--><!--]--> Cookbook <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node-red-contrib-home-assistant-websocket/scrubber/" class="" aria-label="Scrubber"><!--[--><!--]--> Scrubber <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions" rel="noopener noreferrer" target="_blank" aria-label="Forums"><!--[--><!--]--> Forums <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Cookbook <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item active">JSONata <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/call-service.html" class="sidebar-item" aria-label="Call Service"><!--[--><!--]--> Call Service <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/change-node.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Change node"><!--[--><!--]--> Change node <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/change-node.html#read-a-person-state-history-for-the-past-week" class="router-link-active router-link-exact-active sidebar-item" aria-label="Read a person state history for the past week"><!--[--><!--]--> Read a person state history for the past week <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/change-node.html#report-only-those-periods-when-not-home-during-the-day" class="router-link-active router-link-exact-active sidebar-item" aria-label="Report only those periods when &#39;not home&#39; during the day"><!--[--><!--]--> Report only those periods when &#39;not home&#39; during the day <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/current-state.html" class="sidebar-item" aria-label="Current State"><!--[--><!--]--> Current State <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/events-state.html" class="sidebar-item" aria-label="Events: state"><!--[--><!--]--> Events: state <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/functions.html" class="sidebar-item" aria-label="Other functions"><!--[--><!--]--> Other functions <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/sensor.html" class="sidebar-item" aria-label="Sensor"><!--[--><!--]--> Sensor <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/switch-node.html" class="sidebar-item" aria-label="Switch node"><!--[--><!--]--> Switch node <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/trigger-state.html" class="sidebar-item" aria-label="Trigger: state"><!--[--><!--]--> Trigger: state <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/motion-triggered-light.html" class="sidebar-item" aria-label="Motion Triggered Light"><!--[--><!--]--> Motion Triggered Light <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/saving-and-restoring-states.html" class="sidebar-item" aria-label="Saving and Restoring States"><!--[--><!--]--> Saving and Restoring States <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/get-state_changed-events-based-on-area.html" class="sidebar-item" aria-label="Get state_changed Events Based on Area"><!--[--><!--]--> Get state_changed Events Based on Area <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/sun-events.html" class="sidebar-item" aria-label="Turn Light On/Off with Sunset/Sunrise"><!--[--><!--]--> Turn Light On/Off with Sunset/Sunrise <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/vacation-mode.html" class="sidebar-item" aria-label="Vacation Mode"><!--[--><!--]--> Vacation Mode <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/expiration-date-monitor.html" class="sidebar-item" aria-label="Expiration Date Monitor with notification"><!--[--><!--]--> Expiration Date Monitor with notification <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/using-date-and-time-entities-to-trigger-flows.html" class="sidebar-item" aria-label="Using Date and Time entities to trigger flows"><!--[--><!--]--> Using Date and Time entities to trigger flows <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/check-if-an-entity-was-turned-on-in-the-last-24-hours.html" class="sidebar-item" aria-label="Check if an entity was a certain state in the last 24 hours"><!--[--><!--]--> Check if an entity was a certain state in the last 24 hours <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/starting-flow-after-home-assistant-restart.html" class="sidebar-item" aria-label="Starting a flow after a Home Assistant restart"><!--[--><!--]--> Starting a flow after a Home Assistant restart <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/holiday-lights-scheduler-and-demo-mode-for-wled.html" class="sidebar-item" aria-label="Holiday lights scheduler and demo mode for WLED"><!--[--><!--]--> Holiday lights scheduler and demo mode for WLED <!--[--><!--]--></a><!----></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/actionable-notifications-subflow-for-android.html" class="sidebar-item" aria-label="Actionable Notifications Subflow for Android"><!--[--><!--]--> Actionable Notifications Subflow for Android <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="change-node" tabindex="-1"><a class="header-anchor" href="#change-node" aria-hidden="true">#</a> Change node</h1><p><strong>Using JSONata for more complex tasks:</strong></p><p>Many automations can be coded using a simple JSONata expression at some convenient point in the flow, often directly within one of the WebSocket nodes. Where the data involved is a more complex structure, then JSONata is a powerful tool for manipulating JSON objects and arrays. Almost all computation can be achieved using JSONata in a Change node in place of using a Function node.</p><h2 id="read-a-person-state-history-for-the-past-week" tabindex="-1"><a class="header-anchor" href="#read-a-person-state-history-for-the-past-week" aria-hidden="true">#</a> Read a person state history for the past week</h2><p>Since Home Assistant stores state history for 10 days by default, it is possible to read historic state records. The <strong>Get History</strong> node can do this for any given entity, and using <em>relative time</em> it is easy to obtain an array of past <em>state-change</em> events.</p><p>There are no opportunities to use JSONata within the Get History node itself, however JSONata can be used both to setup the node parameters and to manipulate the returned array. In this example, JSONata is used extensively to:</p><ul><li>set the input parameters for the time period required</li><li>read the current entity state for &#39;now&#39; and the given entity ID</li><li>add an &#39;event&#39; for &#39;now&#39; and an &#39;event&#39; for the start history-period time</li><li>calculate the time interval between successive state changes to create &#39;event-periods&#39;</li><li>filter out any event periods less than, say, 50 minutes or for state &#39;unknown&#39;</li><li>compact any now sequential equal-state events into one longer period</li></ul><p>This returns a filtered array of entity states, with the time that state period started and the time it ended, and the duration in minutes. The requirement for extensive data processing here is due to the way &#39;person&#39; sensors report, giving rise to short periods of &#39;unknown&#39; or &#39;away&#39; because Wi-Fi signal or a smart phone has gone &#39;off-line&#39;.</p><p><img src="/node-red-contrib-home-assistant-websocket/assets/jsonata_7_1-BgEt8HOI.png" alt="screenshot"></p><div class="language-json" data-ext="json"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Process history data using JSONata in a change node&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;style&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#000000&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;nodes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;bd6511844a39ca08&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3d87bbb92fa35243&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;9a3ca494edc54a30&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3a4534cdc46ae67d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;891ee0da3deec2c1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;27f0ecf4ea3dc24f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d5dc0b522463577a&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2499</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">1312</span><span class="token punctuation">,</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">122</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;bd6511844a39ca08&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-current-state&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Get current state&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;server&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;outputs&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;halt_if&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;halt_if_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;halt_if_compare&quot;</span><span class="token operator">:</span><span class="token string">&quot;is&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;entity_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;person.george&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;state_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;blockInputOverrides&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;outputProperties&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;propertyType&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload ~&gt; |$|{\&quot;entityId\&quot;: $entity().entity_id}|&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueType&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;propertyType&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;valueType&quot;</span><span class="token operator">:</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;for&quot;</span><span class="token operator">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;forType&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;forUnits&quot;</span><span class="token operator">:</span><span class="token string">&quot;minutes&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;override_topic&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;state_location&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;override_payload&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;entity_location&quot;</span><span class="token operator">:</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;override_data&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">350</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2540</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;9a3ca494edc54a30&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;3d87bbb92fa35243&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;inject&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Set parameters&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;props&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;p&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;p&quot;</span><span class="token operator">:</span><span class="token string">&quot;startAt&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token string">&quot;$fromMillis($millis()-(7*24*60*60000))&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vt&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;crontab&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;once&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;onceDelay&quot;</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;payload&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\&quot;relativeTime\&quot;: \&quot;1 week\&quot;\t}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;payloadType&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2540</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;bd6511844a39ca08&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;9a3ca494edc54a30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-get-history&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Read history&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;server&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;startDate&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;endDate&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;entityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;entityIdType&quot;</span><span class="token operator">:</span><span class="token string">&quot;equals&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;useRelativeTime&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;relativeTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;flatten&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;outputType&quot;</span><span class="token operator">:</span><span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;outputLocationType&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;outputLocation&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">530</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2540</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;3a4534cdc46ae67d&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a4534cdc46ae67d&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Get filtered state periods&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;p&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;pt&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;(\t/* FILTER parameters */\t    $fMins:=50;\t\t/* get current state from entity &#39;data&#39;, and set the &#39;last_changed&#39; to now */\t    $first:= data~&gt;|$|{\&quot;last_changed\&quot;: $now()}|;\t\t/* add this to far end of history payload array, then sort by reverse time order */\t    $x:=$append(payload, $first)^(&gt;last_changed,&gt;last_updated);\t\t/* copy the oldest state value, and add in as the first record at start of history */\t/* we now have a &#39;now&#39; and &#39;start of history&#39; record, even if payload was empty    */    \t    $x:=$append($x,{\&quot;state\&quot;: $x[0].state, \&quot;last_changed\&quot;: startAt});\t\t/* create array of state changes, with how long they have been in that state */\t/* remove any zero periods and unknown states FILTER OUT AS REQUIRED         */\t    $events:=$x#$i.(\t        $prior:= $i&gt;0 ? $x[$i-1] : {\&quot;first\&quot;: $now()};\t        {\&quot;index\&quot;: $i,\t         \&quot;state\&quot;: state,\t         \&quot;from\&quot;: last_changed,\t         \&quot;upto\&quot;: $prior.last_changed,\t         \&quot;dmins\&quot;: ($toMillis($prior.last_changed)-$toMillis(last_changed))/60000~&gt;$round(0)\t        }\t    )[dmins&gt;$fMins and state!=\&quot;unknown\&quot;];\t\t/* merge consecutive records with the same state into one longer period */\t/* get each event position as &#39;start - middle - end&#39; or &#39;only&#39;          */\t\t    $temp:=$events#$v.(\t        $back:= $v&lt;1 ? false : state = $events[$v-1].state;\t        $next:= state = $events[$v+1].state;\t        $position:=( $back ? ($next ? \&quot;middle\&quot; : \&quot;end\&quot;) : ($next ? \&quot;start\&quot; : \&quot;only\&quot;) );\t        $~&gt;|$|{\&quot;index\&quot;: $v, \&quot;position\&quot;: $position}|\t    );\t\t/* get start and end indexes, and zip into a sequence array of [start, end]  */\t/* map this array of sequences to an array of objects, one for each sequence */\t/* where the object is the combination of a run of the same state value      */\t\t    $chain:=$zip($temp[position=\&quot;start\&quot;].index, $temp[position=\&quot;end\&quot;].index);\t\t    $array:=$map($chain, function($item) {(\t        $recA:=$events[$item[0]];\t        $recB:=$events[$item[1]];\t        {\&quot;state\&quot;: $recA.state,\t        \&quot;from\&quot;: $recB.from,\t        \&quot;upto\&quot;:  $recA.upto,\t        \&quot;dmins\&quot;: ($toMillis($recA.upto)-$toMillis($recB.from))/60000~&gt;$round(0),\t        \&quot;position\&quot;: \&quot;merged\&quot;}\t        )\t    });\t\t/* combine the &#39;only&#39; single events with the now-merged sequences, and sort by time */\t    $append($temp[position=\&quot;only\&quot;], $array)^(&gt;from);\t\t)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tot&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;action&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;reg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">750</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2540</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;891ee0da3deec2c1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;27f0ecf4ea3dc24f&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;891ee0da3deec2c1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;State History Events&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;active&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;tosidebar&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;console&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tostatus&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;complete&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusVal&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusType&quot;</span><span class="token operator">:</span><span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">1200</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2540</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;27f0ecf4ea3dc24f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;When &#39;not home&#39; during the day&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;p&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;pt&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload[state=\&quot;not_home\&quot; and ($substringBefore(from,\&quot;T\&quot;) = $substringBefore(upto,\&quot;T\&quot;) ) ]&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tot&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;action&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;reg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">930</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2580</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;d5dc0b522463577a&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;d5dc0b522463577a&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;1997b594da7d37b1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Out during the day&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;active&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;tosidebar&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;console&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tostatus&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;complete&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusVal&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusType&quot;</span><span class="token operator">:</span><span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">1190</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">2580</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-text" data-ext="text"><pre class="language-text"><code>(
/* FILTER parameters */
    $fMins:=50;

/* get current state from entity &#39;data&#39;, and set the &#39;last_changed&#39; to now */
    $first:= data~&gt;|$|{&quot;last_changed&quot;: $now()}|;

/* add this to far end of history payload array, then sort by reverse time order */
    $x:=$append(payload, $first)^(&gt;last_changed,&gt;last_updated);

/* copy the oldest state value, and add in as the first record at start of history */
/* we now have a &#39;now&#39; and &#39;start of history&#39; record, even if payload was empty    */
    $x:=$append($x,{&quot;state&quot;: $x[0].state, &quot;last_changed&quot;: startAt});

/* create array of state changes, with how long they have been in that state */
/* remove any zero periods and unknown states FILTER OUT AS REQUIRED         */
    $events:=$x#$i.(
        $prior:= $i&gt;0 ? $x[$i-1] : {&quot;first&quot;: $now()};
        {&quot;index&quot;: $i,
         &quot;state&quot;: state,
         &quot;from&quot;: last_changed,
         &quot;upto&quot;: $prior.last_changed,
         &quot;dmins&quot;: ($toMillis($prior.last_changed)-$toMillis(last_changed))/60000~&gt;$round(0)
        }
    )[dmins&gt;$fMins and state!=&quot;unknown&quot;];

/* merge consecutive records with the same state into one longer period */
/* get each event position as &#39;start - middle - end&#39; or &#39;only&#39;          */

    $temp:=$events#$v.(
        $back:= $v&lt;1 ? false : state = $events[$v-1].state;
        $next:= state = $events[$v+1].state;
        $position:=( $back ? ($next ? &quot;middle&quot; : &quot;end&quot;) : ($next ? &quot;start&quot; : &quot;only&quot;) );
        $~&gt;|$|{&quot;index&quot;: $v, &quot;position&quot;: $position}|
    );

/* get start and end indexes, and zip into a sequence array of [start, end]  */
/* map this array of sequences to an array of objects, one for each sequence */
/* where the object is the combination of a run of the same state value      */

    $chain:=$zip($temp[position=&quot;start&quot;].index, $temp[position=&quot;end&quot;].index);

    $array:=$map($chain, function($item) {(
        $recA:=$events[$item[0]];
        $recB:=$events[$item[1]];
        {&quot;state&quot;: $recA.state,
        &quot;from&quot;: $recB.from,
        &quot;upto&quot;:  $recA.upto,
        &quot;dmins&quot;: ($toMillis($recA.upto)-$toMillis($recB.from))/60000~&gt;$round(0),
        &quot;position&quot;: &quot;merged&quot;}
        )
    });

/* combine the &#39;only&#39; single events with the now-merged sequences, and sort by time */
    $append($temp[position=&quot;only&quot;], $array)^(&gt;from);

)
</code></pre></div><p><strong>Notes:</strong></p><p>The Inject node uses JSONata to initially create msg.payload as a data object, setting the relative time parameter for the Get History node, and also setting the timestamp for the effective start of this time period.</p><p>The Current State node uses JSONata in the output to retain msg.payload and also merge in the <em>entityId</em> using <code>$entity().entity_id</code>. This now sets msg.payload with the required input parameters for the Get History node (which therefore requires no UI settings). Full entity details are also captured in msg.data as usual.</p><p>::: caution This example code has been tested but person sensors can go &#39;off line&#39; for long periods and the exact nature of the output data should be checked by experimentation. :::</p><h2 id="report-only-those-periods-when-not-home-during-the-day" tabindex="-1"><a class="header-anchor" href="#report-only-those-periods-when-not-home-during-the-day" aria-hidden="true">#</a> Report only those periods when <em>&#39;not home&#39;</em> during the day</h2><p>Once state history has been manipulated like this into an event-array, it is easy to ask questions, such as &quot;how many times has this person been away this week?&quot;</p><p>The question &quot;when was this person away during the day?&quot; for example, can be answered by filtering the state event array, to look for &#39;not home&#39; and for the event period (both start and end) to be entirely on the same date.</p><div class="language-text" data-ext="text"><pre class="language-text"><code>payload[state=&quot;not_home&quot; and ($substringBefore(from,&quot;T&quot;) = $substringBefore(upto,&quot;T&quot;) ) ]
</code></pre></div><p><strong>Note on history records:</strong></p><p>In asking for the history for the past 24 hours, the Get History node will return an array of all state change events that occurred within that time period. If the current state has been unchanged for the entire period requested, then an empty array will be returned.</p><p>To address this, the JSONata code here first adds a record for &#39;now&#39; with the current state. The code then finds the oldest state (which may well be the current &#39;now&#39; state just added) and adds that as a record for &#39;the start of the time period requested&#39; at that state. This ensures that the returned history event array is topped and tailed. The minimum state event array will therefore be <em>one</em> entry from <em>start of history request</em> to <em>now</em>, at the <em>current</em> state.</p><p><strong>Also see:</strong></p><ul><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/guide/jsonata.html" class="">JSONata guide</a></li><li><a href="/node-red-contrib-home-assistant-websocket/cookbook/guide/jsonata-primer.html" class="">JSONata primer</a></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/edit/main/docs/cookbook/jsonata/change-node.md" rel="noopener noreferrer" target="_blank" aria-label="Help us improve this page!"><!--[--><!--]--> Help us improve this page! <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 37859597+zachowj@users.noreply.github.com">Jason</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/call-service.html" class="" aria-label="Call Service"><!--[--><!--]--> Call Service <!--[--><!--]--></a></span><span class="next"><a href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/current-state.html" class="" aria-label="Current State"><!--[--><!--]--> Current State <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/node-red-contrib-home-assistant-websocket/assets/app-sKDtX2xl.js" defer></script>
  </body>
</html>
